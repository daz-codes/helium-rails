// @daz4126/helium@0.15.0 downloaded from https://ga.jspm.io/npm:@daz4126/helium@0.15.0/helium.js

const e=e=>{try{return Function(`return(${e})`)()}catch{return e}};const t=e=>({form:"submit",input:"input",textarea:"input",select:"change"}[e.tagName.toLowerCase()]||"click");const n=(e,t)=>{let n;return(...s)=>(clearTimeout(n),n=setTimeout(e,t,...s))};function s(s={}){let o;const r=(e,...t)=>t.map((e=>`|@${e}|data-he-${e}|`)).join``.includes(`|${e.split(".")[0]}|`);const c=document.querySelector("[\\@helium]")||document.querySelector("[data-helium]")||document.body;const[a,i,l,u,d,h,p]=[new Map,new Map,new WeakMap,new WeakSet,new WeakMap,new Map,new WeakMap];const f=e=>document.querySelector(e);const m=e=>Object.assign(document.createElement("template"),{innerHTML:e.trim()}).content.firstChild;const y=(e,t,n,s)=>{const o=t instanceof Node?t:i.get(t)||f(t);if(o){const t=m(s?s(e):e);n?o[n=="replace"?"replaceWith":n](t):o.innerHTML=t;return t}j[t]=e};const g=(e,t,n={},s={})=>{n.loading&&(n.target=y(n.loading,n.target,n.action)||n.target);const o=s instanceof FormData,r=document.querySelector('meta[name="csrf-token"]')?.content;fetch(e,{method:t,headers:{Accept:"text/vnd.turbo-stream.html,application/json,text/html",...!o&&t!=="GET"&&{"Content-Type":"application/json"},...r&&{"X-CSRF-Token":r}},body:t==="GET"?null:o?s:JSON.stringify(s),credentials:"same-origin"}).then((e=>{const t=e.headers.get("content-type")||"";return t.includes("turbo-stream")?e.text().then((e=>({t:true,d:e}))):t.includes("json")?e.json():e.text()})).then((e=>e.t&&"Turbo"?Turbo.renderStreamMessage(e.d):y(e,n.target,n.loading?"replace":n.action,n.template))).catch((e=>console.error("AJAX:",e.message)))};const b=(e,t)=>g(e,"GET",t);const[v,$,E,k]=["POST","PUT","PATCH","DELETE"].map((e=>(t,n,s)=>g(t,e,s,n)));const T={get(e,t,n){const s=Reflect.get(e,t,n);if(s&&typeof s==="object"){if(p.has(s))return p.get(s);const e=new Proxy(s,T);p.set(s,e);d.set(s,t);return e}return s},set:(e,t,n)=>{const s=Reflect.set(e,t,n);if(Array.isArray(e)&&!isNaN(t)){const t=d.get(e);t&&a.get(t)?.forEach(L)}a.get(t)?.forEach(L);return s}};const j=new Proxy(s,T);function L(t,n={},o=t.el){const{el:r,prop:c,fn:a}=t;const l=a(f,j,n,o,m,...Object.values(s),...i.values());if(c==="innerHTML"&&Array.isArray(l)&&r.children.length>0)return w(r,l);if(c==="innerHTML"){const e=Array.isArray(l)?l.join``:l;return typeof Idiomorph==="object"?Idiomorph.morph(r,e,{morphStyle:"innerHTML"}):r.innerHTML=e}if(c==="class"&&l&&typeof l==="object")return Object.entries(l).forEach((([e,t])=>e.split(/\s+/).forEach((e=>r.classList.toggle(e,t)))));if(c==="style"&&l&&typeof l==="object")return r.style=Object.entries(l).filter((([,e])=>e)).map((([e,t])=>`${e}:${t}`)).join(";");c in r?r.type==="radio"?r.checked=r.value===l:r[c]=c==="textContent"?l:e(l):r.setAttribute(c,e(l))}function w(e,t){const n=m(`<${e.tagName.toLowerCase()}>${t.join``}</${e.tagName.toLowerCase()}>`);const s=[...n.children];const o=s.map(((e,t)=>({key:e.getAttribute("key")||e.dataset.key,element:e,index:t})));const r=[...e.children].map(((e,t)=>({key:e.getAttribute("key")||e.dataset.key,element:e,index:t})));for(let t=0;t<Math.max(o.length,r.length);t++){const n=r[t];const s=o[t];if(!s&&n){A(n.element);n.element.remove()}else if(s&&!n)e.appendChild(s.element);else if(s&&n&&n.element.outerHTML!==s.element.outerHTML)if(typeof Idiomorph==="object")Idiomorph.morph(n.element,s.element.outerHTML);else{A(n.element);n.element.replaceWith(s.element)}}}const x=(e,t=false)=>{const n=`${t}:${e}`;if(h.has(n))return h.get(n);try{const o=new Function("$","$data","$event","$el","$html","$get","$post","$put","$patch","$delete",...Object.keys(s),...[...i.keys()],`with($data){${t?"return":""}(${e.trim()})}`);h.set(n,o);return o}catch{return()=>e}};const M=(e,t)=>{const n=new Set;const o=new Proxy(s,{get(e,t){typeof t=="string"&&n.add(t);const s=e[t];return typeof s=="object"&&s!=null?new Proxy(s,this):s}});try{e.call(null,f,o,i)}catch{}return[...n]};const A=e=>{[e,...e.querySelectorAll("*")].forEach((e=>{l.get(e)?.forEach((({receiver:e,event:t,handler:n})=>e.removeEventListener(t,n)));l.delete(e)}))};function C(e){const c=[];const d=[e,...e.querySelectorAll("*")].filter((e=>!u.has(e)&&[...e.attributes].some((e=>/^(@|:|data-he)/.test(e.name)))));const h=(e,t)=>{a.set(e,[...a.get(e)||[],t]);c.push(t)};d.forEach((e=>{u.add(e);const c=e.attributes;const a=t=>x(t,true)(f,j,{},e,m,b,v,$,E,k,...Object.values(s),...i.values());const d=e.type?.toLowerCase();const p=d=="checkbox",y=d=="radio",T=e.tagName=="SELECT";for(let u=0;u<c.length;u++){const{name:d,value:L}=c[u];if(d.startsWith("@")||d.startsWith(":")||d.startsWith("data-he")){if(r(d,"text","html","bind"))try{new Function(`let ${L}=1`);j[L]??=r(d,"bind")?e.type=="checkbox"?e.checked:e.value:e.textContent}catch{}if(["@data","data-he"].includes(d))Object.assign(j,a(L));else if(r(d,"ref"))i.set("$"+L,e);else if(r(d,"text","html")){const t=x(L,true);const n={el:e,prop:r(d,"text")?"textContent":"innerHTML",fn:t};M(t,e).forEach((e=>h(e,n)))}else if(r(d,"bind")){const t=p||y||T?"change":"input";const n=p?"checked":"value";const s=e=>j[L]=p?e.target.checked:e.target.value;e.addEventListener(t,s);l.has(e)||l.set(e,[]);l.get(e).push({receiver:e,event:t,handler:s});h(L,{el:e,prop:n,fn:x(L,true)});p?e.checked=!!j[L]:y?e.checked=e.value==j[L]:e.value=j[L]??""}else if(r(d,"hidden","visible")){const t=x(`${r(d,"hidden")?"!":""}!(${L})`,true);M(t,e).forEach((n=>h(n,{el:e,prop:"hidden",fn:t})))}else if(r(d,"class")){const t=x(L,true);M(t,e).forEach((n=>h(n,{el:e,prop:"class",fn:t})))}else if(d.startsWith(":")){const t=x(L,true);M(t,e).forEach((n=>h(n,{el:e,prop:d.slice(1),fn:t})))}else if(r(d,"init"))o=x(L,true);else if(d.startsWith("@")||d.startsWith("data-he")){const o=d.startsWith("@")?d.slice(1):d.slice(8);const[r,...c]=o.split(".");const u=["get","post","put","patch","delete"].includes(r);const h=u?t(e):r;const p=c.includes("outside")||c.includes("document")?document:e;const y=c.find((e=>e.startsWith("debounce")));const T=y?(e=>e&&!isNaN(e)?Number(e):300)(y.split(":")[1]):0;const w=t=>{const n=n=>x(n,true)(f,j,t,e,m,b,v,$,E,k,...Object.values(s),...i.values());c.includes("prevent")&&t.preventDefault();const o={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"};for(const[e,n]of Object.entries(o))if(c.includes(e)&&!t[n])return;if(["keydown","keyup","keypress"].includes(h)){const e=c[c.length-1];if(e&&!["prevent","once","outside","document"].includes(e)){const n=t.key==" "?"Space":t.key=="Escape"?"Esc":t.key;if(n.toLowerCase()!==e.toLowerCase())return}}if(!c.includes("outside")||!e.contains(t.target))if(u){const t=t=>e.getAttribute(`data-he-${t}`)||e.getAttribute(`@${t}`);const[s,o]=(t("target")||"").split(":");const c={...n(t("options")||"{}"),...s&&{target:s},...o&&{action:o},...a(t("template"))&&{template:a(t("template"))},...t("loading")&&{loading:t("loading")}};let i=t("params")||"{}";if(!i.trim().startsWith("{")&&i.includes(":")){const t=i.split(":").map((e=>e.trim()));i=t.reduceRight(((t,n,s)=>`{ ${n}: ${s==1?`'${e[t]}'`:t} }`))}const l=n(i);g(L,r.toUpperCase(),c,l)}else n(L);c.includes("once")&&p.removeEventListener(h,M)};const M=T>0?n(w,T):w;p.addEventListener(h,M);l.has(e)||l.set(e,[]);l.get(e).push({receiver:p,event:h,handler:M})}}}}));return c}new MutationObserver((e=>{for(const t of e){t.removedNodes.forEach((e=>e.nodeType===1&&A(e)));t.addedNodes.forEach((e=>e.nodeType===1&&!u.has(e)&&C(e).forEach(L)))}})).observe(c,{childList:1,subtree:1});C(c);for(const[e,t]of a.entries())t.forEach(L);o&&o(f,j,{},{},m,b,v,$,E,k,...Object.values(s),...i.values())}export{s as default};

